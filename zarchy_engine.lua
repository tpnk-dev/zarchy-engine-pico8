-- TERRAIN SETTINGS

-- 0-start

HEIGHT_MULTIPLIER = 2
terrain_vertex_data = store_terrain_rle_table(explode64("3?3?014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m8%3l89cs833l88c2gqc1833l87c2g2kog1c1833l87c1g2k2omk1g1c1833l86c2g1k2o2sko1k1g1c1833l84c3g2k1o2s2wis1o1k1g1c1833l84c1g3k2o1s2w2!gw1s1o1k1g1c1833l84c1g1k3o2s1w2!2%e!1w1s1o1k1g1c1833l84c1g1k1o3s2w1!2%2(c%1!1w1s1o1k1g1c1833l84c1g1k1o1s3w2!1%2(2+a(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w3!2%1(2+2}8+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!3%2(1+2}2<6}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%3(2+1}2<2/4<1}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(3+2}1<2/5<1}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+3}2<1/6<1}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}3<2/6<1}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<3/7<1}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<1/8<2}1+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<1/7<2}2+1(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<1/6<2}2+2(1%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<1/5<2}2+2(2%1!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}1<7}2+2(2%2!1w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+1}9+2(2%2!2w1s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(1+b(2%2!2w2s1o1k1g1c1833l84c1g1k1o1s1w1!1%1(d%2!2w2s2o1k1g1c1830]4c2m84c1g1k1o1s1w1!1%f!2w2s2o2k1g1c1830[418c412l84c1g1k1o1s1w1!hw2s2o2k2g1c1830=4182ca82432i84c1g1k1o1s1wjs2o2k2g2c1830+4182c1gac184432f84c1g1k1o1slo2k2g2c2830+4181c1g2k8g2c3844f2084c1g1k1onk2g2c2840+4181c1g1k1o8k1g4c38g411|84c1g1kpg2c2850+4181c1g1k1o1s6o2k3g4cf82411~84c1grc2860+4181c1g1k1o1s1w4s2o4k3ggc182411?84ct870+4181c1g1k1o1s1w1!2w2s4o4kfg2c182411/8%0+4181c1g1k1o1s1w1!4w1s6ogk1g2c181411/8%0+4181c1g1k1o1s1w2!3w3sjo2k1g1c181411/8%0+4181c1g1k1o1s2w2!4w1s3w3s6w6s2o1k1g1c181411/8%0+4181c1g1k1o2s1w3!1%1!1w9s1was1o1k1g1c181411/8%0-4182c1g1k1o2s1w3!1%2!1wd!4w2s1o1k1g1c181411/8%0_4182c1g2k1o1s2w3!2%2!6w5!3%2!2w1s1o1k1g1c181411/8%0_4181c1g2k1o2s1w5!1%7!2w4!1%5!1w1s1o1k1g1c181411/014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o2s2w4!2%1(6%1!6%5!1w1s1o1k1g1c182411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s2w4!2%1(2+4(2%b!1w1s1o1k1g2c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w5!1%1(2+1}4+1(8%3!2w1s1o2k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w2!4%1(1+1}2<2}2+7(2%2!1w2s2o1k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w1!2%3(1+2}1<1/2<1}2+1}5+1(2%1!2w2s1o1k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w1!1%2(2+2}2<1/3<1}3<3}2+1(2%1!2w1s1o1k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w1!1%1(2+2}2<1/5<3/3<1}2+1(2%1!1w1s1o1k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w1!1%1(1+2}2<2/5<1/6<1}2+1(1%1!1w1s1o1k1g1c181411.014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181410-4181c1g1k1o1s1w1!1%1(1+1}2<1/f<1}1+1(1%1!1w1s1o1k1g1c181411.014181c10wc181410-4181c1g1k1o1s1w1!1%1(1+1}1<1/g<1}1+1(1%1!1w1s1o1k1g1c181411.014181c1014u01c181410-4181c1g1k1o1s1w1!1%1(1+1}2<3/b<2}2+1(1%1!1w1s1o1k1g1c181411.014181c101418s4101c181410-4181c1g1k1o1s1w1!1%1(1+2}3<1/9<2}3+1(2%1!1w1s1o1k1g1c181411.014181c1014181cq814101c181410-4181c1g1k1o1s1w1!1%1(2+3}2<1/7<3}1+2(2%1!2w1s1o1k1g1c182411,014181c1014181c1goc1814101c181410-4181c1g1k1o1s1w1!1%2(3+2}1<1/8<2}2+1(1%1!2w2s1o1k1g1c282411>014181c1014181c1g1kmg1c1814101c181410-4181c1g1k1o1s1w1!2%4(1+1}1<1/a<1}1+1(1%1!1w2s2o1k1g3c182411<014181c1014181c1g1k1okk1g1c1814101c181410-4181c1g1k1o1s1w2!4%1(1+1}2<1/8<1}2+1(1%1!1w3s1o2k2g2c182411:014181c1014181c1g1k1o1sio1k1g1c1814101c181410-4181c1g1k1o1s2w4!1%1(2+1}2<3/4<1}2+1(2%1!1w4s1o3k1g2c181411:014181c1014181c1g1k1o1s1wgs1o1k1g1c1814101c181410-4181c1g1k1o2s1w4!2%1(2+1}4<4}2+1(2%1!2w5s2o2k1g1c181411:014181c1014181c1g1k1o1s1w1!ew1s1o1k1g1c1814101c181410-4181c1g1k2o1s2w4!2%1(2+3}6+1(2%1!2w7s2o1k1g1c181411:014181c1014181c1g1k1o1s1w1!1%c!1w1s1o1k1g1c1814101c181410-4181c1g1k2o1s2w3!2%1(6+6(2%1!2w2s3w3s2o1k1g1c181411:014181c1014181c1g1k1o1s1w1!1%1(a%1!1w1s1o1k1g1c1814101c181410_4182c1g1k1o2s1w3!2%1(4%2(2+5(1%1!2w2s2o1s5o2k1g1c181411:014181c1014181c1g1k1o1s1w1!1%1(1+8(1%1!1w1s1o1k1g1c1814101c181410_4181c1g2k1o2s1w3!1%7!1%1(1+4(2%1!1w2s2o8k1g2c181411:014181c1014181c1g1k1o1s1w1!1%1(1+1}6+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o2s2w2!1%3!6%1(2+1(3%2!1w1s2o2k7g2c182411:014181c1014181c1g1k1o1s1w1!1%1(1+1}1<4}1+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o1s2w2!1%2!8%2(3%3!2w1s1o3k1g7c182411<014181c1014181c1g1k1o1s1w1!1%1(1+1}1<1/2<1}1+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o1s1w2!4w5!4%5!3w2s1o2k1g2c682411>014181c1014181c1g1k1o1s1w1!1%1(1+1}1<1/2<1}1+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o1s1w1!3w3s3w3!8w3s2o1k1g2c187411,014181c1014181c1g1k1o1s1w1!1%1(1+1}1<4}1+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o1s1w2!2w1s3o1s4w9s3o2k1g1c182461.014181c1014181c1g1k1o1s1w1!1%1(1+1}6+1(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o1s2w4s1o6sbo3k1g2c1814121014181c1014181c1g1k1o1s1w1!1%1(1+8(1%1!1w1s1o1k1g1c1814101c181410_4181c1g1k1o2s6o1k4odk2g2c1824121014181c1014181c1g1k1o1s1w1!1%1(a%1!1w1s1o1k1g1c1814101c181410_4181c1g2k1o8k1g3kdg3c1824122014181c1014181c1g1k1o1s1w1!1%c!1w1s1o1k1g1c1814101c181410_4182c1g2k8g2c1gfc2824123014181c1014181c1g1k1o1s1w1!ew1s1o1k1g1c1814101c181410-4182c1gach834124014181c1014181c1g1k1o1s1wgs1o1k1g1c1814101c181410+4182ca8i4225014181c1014181c1g1k1o1sio1k1g1c1814101c181410=418c4h27014181c1014181c1g1k1okk1g1c1814101c181410[4c2o014181c1014181c1g1kmg1c1814101c181413m014181c1014181c1goc1814101c181413m014181c1014181cq814101c181413m014181c101418s4101c181413m014181c1014u01c181413m014181c10wc181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/108/1<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<1/a<1}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}1<c}1+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+1}e+1(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m014181c1g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m04g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m04g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m04g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m04g1k1o1s1w1!1%1(1+g(1%1!1w1s1o1k1g1c181413m"), 

explode64("3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?3?014101410141014101413]3?014101410141014101413]3?014101410141014101413]3?014101410141014101413]3?014101410141014101413]3?"),HEIGHT_MULTIPLIER)


terrain_num_verts = #terrain_vertex_data+1 -- HAS TO BE AN ODD NUMBER
terrain_num_faces = terrain_num_verts-1

-- SECTOR SETTINGS
NUM_SECTORS = 28

num_faces_sector = terrain_num_faces/NUM_SECTORS
num_verts_sector = num_faces_sector + 1

-- TILE SETTING
tile_size = 10

-- PROJECTION SETTINGS
k_screen_scale=80
k_x_center=63
k_y_center=63

z_clip=1000
z_max=15

-- CAMERA SETTINGS
cam_dist_terrain = 450
cam_x = 0
cam_y = 50
cam_z = -cam_dist_terrain

cam_ax, cam_ay, cam_az = -0.1,0.5,0

-- PLAYER PARAMS
player = nil
mov_tiles_x = 0
mov_tiles_z = 0

-- RENDER STUFF
triangle_list = {}

-- cam_matrix_transform
sx=sin(cam_ax)
sy=sin(cam_ay)
sz=sin(cam_az)
cx=cos(cam_ax)
cy=cos(cam_ay)
cz=cos(cam_az)

cam_mat00=cz*cy
cam_mat10=-sz
cam_mat20=cz*sy
cam_mat01=cx*sz*cy+sx*sy
cam_mat11=cx*cz
cam_mat21=cx*sz*sy-sx*cy
cam_mat02=sx*sz*cy-cx*sy
cam_mat12=sx*cz
cam_mat22=sx*sz*sy+cx*cy

function rotate_cam_point(x,y,z)
    return (x)*cam_mat00+(y)*cam_mat10+(z)*cam_mat20,(x)*cam_mat01+(y)*cam_mat11+(z)*cam_mat21,(x)*cam_mat02+(y)*cam_mat12+(z)*cam_mat22
end

function trifill(x1,y1,x2,y2,x3,y3, color)
	color1 = color
	local x1=band(x1,0xffff)
          local x2=band(x2,0xffff)
          local y1=band(y1,0xffff)
          local y2=band(y2,0xffff)
          local x3=band(x3,0xffff)
          local y3=band(y3,0xffff)
          
          local nsx,nex
          --sort y1,y2,y3
          if(y1>y2)then
            y1,y2=y2,y1
            x1,x2=x2,x1
          end
          
          if(y1>y3)then
            y1,y3=y3,y1
            x1,x3=x3,x1
          end
          
          if(y2>y3)then
            y2,y3=y3,y2
            x2,x3=x3,x2          
          end
          
         if(y1!=y2)then          
            local delta_sx=(x3-x1)/(y3-y1)
            local delta_ex=(x2-x1)/(y2-y1)
           
            if(y1>0)then
                nsx=x1
                nex=x1
                min_y=y1
            else --top edge clip
                nsx=x1-delta_sx*y1
                nex=x1-delta_ex*y1
                min_y=0
            end
           
            max_y=min(y2,128)
           
            for y=min_y,max_y-1 do

            rectfill(nsx,y,nex,y,color1)
            --if(band(y,1)==0)then rectfill(nsx,y,nex,y,color1) else rectfill(nsx,y,nex,y,color2) end
            nsx+=delta_sx
            nex+=delta_ex
            end

        else --where top edge is horizontal
            nsx=x1
            nex=x2
        end

          
        if(y3!=y2)then
            local delta_sx=(x3-x1)/(y3-y1)
            local delta_ex=(x3-x2)/(y3-y2)
           
            min_y=y2
            max_y=min(y3,128)
            if(y2<0)then
                nex=x2-delta_ex*y2
                nsx=x1-delta_sx*y1
                min_y=0
            end
           
             for y=min_y,max_y do

                rectfill(nsx,y,nex,y,color1)
                --if(band(y,1)==0)then rectfill(nsx,y,nex,y,color1) else rectfill(nsx,y,nex,y,color2) end
                nex+=delta_ex
                nsx+=delta_sx
             end
           
        else --where bottom edge is horizontal
            rectfill(nsx,y3,nex,y3,color1)
            --if(band(y,1)==0)then rectfill(nsx,y3,nex,y3,color1) else rectfill(nsx,y3,nex,y3,color2) end
        end

end

function draw_triangle_list()
    --for t in all(triangle_list) do
    for i=1,#triangle_list do
        local t=triangle_list[i]
        --fillp(0b0000000000000000)
        --if(t.fade_out) fillp(0b1010010110100101)
        trifill( t.p1x,t.p1y,t.p2x,t.p2y,t.p3x,t.p3y, t.color )
    end
end

function render_terrain()
    update_view()

    local trans_proj_verts = {}

    for v=0,(num_verts_sector)*(num_verts_sector)-1 do
        local vert_x_id=(v%num_verts_sector + (mov_tiles_x-flr(num_verts_sector/2-1)))%terrain_num_verts
        local vert_z_id=(flr(v/num_verts_sector) + (mov_tiles_z-flr(num_verts_sector/2 - 1)))%terrain_num_verts

        local vert_world_x = (v%num_verts_sector)*tile_size + (mov_tiles_x-flr(num_verts_sector/2-1))*tile_size
        --print(tonum(sub(-terrain_vertex_data[vert_x_id][vert_z_id],1,2)), 20, 1, 9)
        --stop()
        local vert_world_y = (terrain_vertex_data[vert_x_id][vert_z_id]&0x000f)*2

        local vert_world_z = flr(v/num_verts_sector)*tile_size + (mov_tiles_z-flr(num_verts_sector/2 - 1))*tile_size

        local vert_camera_x = vert_world_x - cam_x 
        local vert_camera_y = vert_world_y - cam_y
        local vert_camera_z = vert_world_z - cam_z

        if(v%num_verts_sector == 0)then  
            vert_camera_x+=sub_mov_x*tile_size  
        end

        if(v%num_verts_sector == num_faces_sector)then 
            vert_camera_x+=sub_mov_x*tile_size - tile_size
        end

        
        if(flr(v/num_verts_sector) == 0)then 
            vert_camera_z+=sub_mov_z*tile_size 
        end

        if(flr(v/num_verts_sector) == num_faces_sector)then 
            vert_camera_z+=sub_mov_z*tile_size - tile_size
        end

        vert_camera_x, vert_camera_y, vert_camera_z=rotate_cam_point(vert_camera_x, vert_camera_y, vert_camera_z)
        
        trans_proj_vert = add(trans_proj_verts, {vert_camera_x, vert_camera_y, vert_camera_z, vert_camera_x*k_screen_scale/vert_camera_z+k_x_center,vert_camera_y*k_screen_scale/vert_camera_z+k_x_center, (terrain_vertex_data[vert_x_id][vert_z_id]&0x000f)})


        --x[[ PRINT VERTEX DATA
        if(v%num_verts_sector == 0)then 
            print(tostr(vert_z_id), trans_proj_vert[4]-15, trans_proj_vert[5], 11)
        end

        if(flr(v/num_verts_sector) == 0)then 
            print(tostr(vert_x_id), trans_proj_vert[4], trans_proj_vert[5]+6, 11)
        end
        --]]

        --x[[ PRINT . 
            print(".", trans_proj_vert[4], trans_proj_vert[5]-3, ((terrain_vertex_data[vert_x_id][vert_z_id]&0x00f0)>>4) + 2)
        --]]
        
        --x[[ PRINT VERTEX DATA
        --print(vert_camera_y, trans_proj_vert[4], trans_proj_vert[5], 5)
        --]]
    end

    print("player_pos: "..player.x..","..player.z,0,10)
    print("mov_tiles: "..mov_tiles_x..","..mov_tiles_z,0,20)

    for v=#trans_proj_verts,1,-1 do
        if((v)%num_verts_sector != 0 and v>num_verts_sector-1) then
            local p1 = trans_proj_verts[v+1] -- root vertex
            local p3 = trans_proj_verts[v-1+1]
            local p2 = trans_proj_verts[v - num_verts_sector + 1]
            local p4 = trans_proj_verts[v -  num_verts_sector]
            
            --[[ WIREFRAME
            line(p1[4],p1[5], p2[4],p2[5], 7)
            line(p2[4],p2[5], p4[4],p4[5], 7)
            --line(p4[4],p4[5], p1[4],p1[5], 7)

            line(p4[4],p4[5], p3[4],p3[5], 7)
            line(p3[4],p3[5], p1[4],p1[5], 7)
           -- line(p1[4],p1[5], p4[4],p4[5], 7)
            --]]
            

            --x[[ PRINT 
                print(".", p1[4],p1[5]-3, 8)
                --print(v, p1[4],p1[5]-3, 8)
            --]]

            local p1x,p1y,p1z= p1[1], p1[2], p1[3] 
            local p2x,p2y,p2z= p2[1], p2[2], p2[3] 
            local p3x,p3y,p3z= p3[1], p3[2], p3[3] 
            local p4x,p4y,p4z= p4[1], p4[2], p4[3]

            local cz=.01*(p1z+p2z+p3z)/3
            local cx=.01*(p1x+p2x+p3x)/3
            local cy=.01*(p1y+p2y+p3y)/3
            local z_paint= -cx*cx-cy*cy-cz*cz

            local fade_out = false
            
            local s1x,s1y = p1[4],p1[5]
            local s2x,s2y = p2[4],p2[5]
            local s3x,s3y = p3[4],p3[5]
            local s4x,s4y = p4[4],p4[5]

            if(( (s1x-s2x)*(s4y-s2y)-(s1y-s2y)*(s4x-s2x)) < 0)then
                add(triangle_list,{
                    p1x=s1x,
                    p1y=s1y,
                    p2x=s2x,
                    p2y=s2y,
                    p3x=s4x,
                    p3y=s4y,
                    tz=z_paint,
                    color=p2[6],
                    fade_out=fade_out})
            end
            if(( (s4x-s3x)*(s1y-s3y)-(s4y-s3y)*(s1x-s3x)) < 0)then
                add(triangle_list,{
                    p1x=s4x,
                    p1y=s4y,
                    p2x=s3x,
                    p2y=s3y,
                    p3x=s1x,
                    p3y=s1y,
                    tz=z_paint,
                    color=p2[6],
                    fade_out=fade_out})
            end
            

        end
        
    end

    draw_triangle_list()
    triangle_list = {}

    --x[[ PRINT 
        print("ì›ƒ", trans_proj_verts[num_verts_sector/2 + (num_verts_sector*(num_verts_sector/2- 1))][4]-3, trans_proj_verts[num_verts_sector/2 + (num_verts_sector*(num_verts_sector/2 - 1))][5]-5, 8)
    --]]
end

function update_view()
    mov_tiles_x = flr(player.x/tile_size)
    mov_tiles_z = flr(player.z/tile_size)

    sub_mov_x =  (player.x/tile_size) % 1 
    sub_mov_z =  (player.z/tile_size) % 1 
end
